<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:TodoAvalonia.ViewModels"
        xmlns:models="using:TodoAvalonia.Models"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="700"
        x:Class="TodoAvalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="Todo List"
        Width="600" Height="700"
        MinWidth="400" MinHeight="500">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <Style Selector="Border.todo-item">
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="15"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Background" Value="White"/>
        </Style>

        <Style Selector="TextBlock.title">
            <Setter Property="FontSize" Value="32"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,20,0,20"/>
        </Style>

        <Style Selector="TextBlock.completed">
            <Setter Property="TextDecorations" Value="Strikethrough"/>
            <Setter Property="Foreground" Value="Gray"/>
        </Style>

        <Style Selector="TextBlock.timestamp">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="Gray"/>
            <Setter Property="Margin" Value="0,5,0,0"/>
        </Style>

        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#007AFF"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#0051D5"/>
        </Style>

        <Style Selector="Button.delete">
            <Setter Property="Background" Value="#FF3B30"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <Style Selector="Button.delete:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#D32F2F"/>
        </Style>

        <Style Selector="TextBox.input">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
    </Window.Styles>

    <DockPanel Margin="20">
        <!-- Header -->
        <TextBlock DockPanel.Dock="Top"
                   Text="ðŸ“ Todo List"
                   Classes="title"/>

        <!-- Input Section -->
        <Grid DockPanel.Dock="Top"
              ColumnDefinitions="*,Auto"
              Margin="0,0,0,20">
            <TextBox Grid.Column="0"
                     Text="{Binding NewTodoText}"
                     Watermark="Enter a new task..."
                     Classes="input"
                     Margin="0,0,10,0">
                <TextBox.KeyBindings>
                    <KeyBinding Gesture="Enter" Command="{Binding AddTodoCommand}"/>
                </TextBox.KeyBindings>
            </TextBox>

            <Button Grid.Column="1"
                    Content="Add"
                    Command="{Binding AddTodoCommand}"
                    Classes="primary"/>
        </Grid>

        <!-- Todo List -->
        <ScrollViewer>
            <ItemsControl ItemsSource="{Binding Todos}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:Todo">
                        <Border Classes="todo-item">
                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">
                                <!-- CheckBox -->
                                <CheckBox Grid.Column="0"
                                         IsChecked="{Binding IsCompleted}"
                                         VerticalAlignment="Center"
                                         Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ToggleTodoCommand}"
                                         CommandParameter="{Binding .}"/>

                                <!-- Task Content -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Text}"
                                              FontSize="16"
                                              TextWrapping="Wrap"
                                              Classes.completed="{Binding IsCompleted}"/>

                                    <TextBlock Text="{Binding CreatedAt, StringFormat='{}{0:MMM dd, yyyy HH:mm}'}"
                                              Classes="timestamp"/>
                                </StackPanel>

                                <!-- Delete Button -->
                                <Button Grid.Column="2"
                                       Content="Delete"
                                       Classes="delete"
                                       VerticalAlignment="Center"
                                       Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).DeleteTodoCommand}"
                                       CommandParameter="{Binding .}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>

                <!-- Empty State -->
                <ItemsControl.Styles>
                    <Style Selector="ItemsControl">
                        <Setter Property="IsVisible" Value="True"/>
                    </Style>
                </ItemsControl.Styles>
            </ItemsControl>
        </ScrollViewer>

        <!-- Empty State Message -->
        <Panel DockPanel.Dock="Bottom" IsVisible="{Binding !Todos.Count}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,100,0,0">
                <TextBlock Text="No tasks yet!"
                          FontSize="20"
                          Foreground="Gray"
                          HorizontalAlignment="Center"/>
                <TextBlock Text="Add a task to get started"
                          FontSize="14"
                          Foreground="LightGray"
                          HorizontalAlignment="Center"
                          Margin="0,10,0,0"/>
            </StackPanel>
        </Panel>
    </DockPanel>
</Window>
